{{ 'modal-section.css' | asset_url | stylesheet_tag }}

  <div class="custom-modal-section {% if section.settings.test_mode %}test-mode-active{% endif %}" 
     data-section-id="{{ section.id }}" 
     data-delay="{{ section.settings.delay_time }}">
    <div class="modal-overlay" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true">

        <button class="close-modal-btn" aria-label="Close modal">
          {% comment %} Using eager loading for icons too {% endcomment %}
          <img src="{{ 'x.svg' | asset_url }}" class="close-icon" alt="" loading="eager" width="20" height="20">
        </button>

        <div class="modal-hero">
          {% comment %} Logo: Pull alt from image object if text field is empty {% endcomment %}
          {%- liquid
            assign logo_alt = section.settings.modal_logo.alt | default: section.settings.modal_logo_alt
            assign main_alt = section.settings.modal_image.alt | default: section.settings.modal_image_alt
          -%}

          {% if section.settings.modal_logo %}
            {{ section.settings.modal_logo | image_url: width: 500 | image_tag: class: 'modal-logo', alt: logo_alt, loading: 'eager' }}
          {% else %}
            <img src="{{ 'goodr_logo_white.svg' | asset_url }}" class="modal-logo" alt="Logo" loading="eager" width="200" height="auto">
          {% endif %}

          {% comment %} Desktop Background {% endcomment %}
          {% if section.settings.modal_image %}
            {{ section.settings.modal_image | image_url: width: 1000 | image_tag: class: 'modal-img display-desktop', alt: main_alt, loading: 'eager', widths: '484, 748, 1000' }}
          {% else %}
            <img src="{{ 'desktop_popup_img.png' | asset_url }}" class="modal-img display-desktop" alt="Desktop Background" loading="eager" width="100%" height="auto">
          {% endif %}
          
          {% comment %} Mobile Background {% endcomment %}
          {% if section.settings.modal_image_mobile %}
            {{ section.settings.modal_image_mobile | image_url: width: 600 | image_tag: class: 'modal-img display-mobile', alt: main_alt, loading: 'eager', widths: '326, 600' }}
          {% elsif section.settings.modal_image %}
            {{ section.settings.modal_image | image_url: width: 600 | image_tag: class: 'modal-img display-mobile', alt: main_alt, loading: 'eager' }}
					{% else %}
						<img 
							src="{{ 'mobile_popup_img.png' | asset_url }}" 
							class="modal-img display-mobile" 
							alt="Mobile Background" 
							loading="eager" 
							width="326" 
							height="auto"
						>
          {% endif %}
        </div>

        	{% comment %} Only show text if description or discount code exists {% endcomment %}
					{%- liquid
						assign discount_span = '<span class="discount-code">' | append: section.settings.discount_code | append: '</span>'
						assign description_text = section.settings.modal_description | default: "USE CODE [code] FOR $5 OFF YOUR FIRST ORDER"
						assign formatted_description = description_text | replace: '[code]', discount_span
					-%}

					{% if formatted_description != blank %}
						<p class="modal-description">{{ formatted_description }}</p>
					{% endif %}

        <div class="modal-btn-group">
          <a class="confirm-modal-btn" href="{{ section.settings.confirm_button_link }}">
            {{ section.settings.confirm_button_text | default: 'SHOP NOW' }}
          </a>
          <button class="dismiss-modal-btn" type="button">
            {{ section.settings.dismiss_button_text | default: 'No Thanks' }}
          </button>
        </div>
      </div>
    </div>
  </div>

<script src="{{ 'modal-section.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Modal Popup",
  "settings": [
				{
			"type": "checkbox",
			"id": "test_mode",
			"label": "Force Open (Test Mode)",
			"default": false,
			"info": "Check this to keep the modal open while you style it in the editor."
		},
    {
      "type": "image_picker",
      "id": "modal_logo",
      "label": "Modal Logo",
			"info": "The main logo image displayed in the modal."
    },
		{
      "type": "image_picker",
      "id": "modal_image",
      "label": "Modal Image",
			"info": "The main image displayed in the modal. This will be used for desktop view if a separate mobile image isn't uploaded."
    },
		{
			"type": "image_picker",
			"id": "modal_image_mobile",
			"label": "Mobile Image (Optional)",
			"info": "The main image displayed in the modal. This will be used for mobile view."
		},
		{
			"type": "text",
			"id": "modal_image_alt",
			"label": "Modal Image Alt Text",
			"default": "Modal Image",
			"info": "The alt text for the main modal image."
		}, 
		{
      "type": "text",
      "id": "discount_code",
			"default": "GOODR5",
			"label": "Discount Code",
			"info": "The discount code to be displayed in the modal."
    },
    {
      "type": "text",
      "id": "modal_description",
      "label": "Modal Description",
			"default": "USE CODE [code] FOR $5 OFF YOUR FIRST ORDER",
			"info": "The main text description in the modal. Use [code] to insert the discount code within the text."
    },
    {
      "type": "text",
      "id": "confirm_button_text",
      "label": "Confirm Button Text",
      "default": "SHOP ALL STYLES",
			"info": "The text for the confirm button that takes users to the collection or product page."
    },
		{
      "type": "url",
      "id": "confirm_button_link",
      "label": "Confirm Button Link",
			"default": "/collections/all",
			"info": "The URL that the confirm button will link to. This can be a collection, product, or any page on your site."
    },
    {
      "type": "text",
      "id": "dismiss_button_text",
      "label": "Dismiss Button Text",
      "default": "NAH, I HATE DEALS",
			"info": "The text for the dismiss button that closes the modal."
    },
    {
      "type": "range",
      "id": "delay_time",
      "min": 1,
      "max": 20,
      "step": 1,
      "unit": "sec",
      "label": "Delay before showing",
      "default": 2,
			"info": "The delay time in seconds before the modal is shown."
    }
  ],
  "presets": [
    {
      "name": "Modal Section"
    }
  ]
}
{% endschema %}